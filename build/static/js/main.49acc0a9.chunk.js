(this.webpackJsonp3drw=this.webpackJsonp3drw||[]).push([[0],{180:function(e,t){},209:function(e,t,a){e.exports=a(467)},214:function(e,t,a){},216:function(e,t,a){},230:function(e,t,a){},437:function(e,t){},438:function(e,t){},439:function(e,t,a){},467:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(23),i=a.n(o),c=(a(214),a(215),a(17)),l=a(14),s=a(13),d=(a(216),a(16)),m=a(1),u=a(207);var p=function(e){var t=Object(n.useCallback)((function(e){}),[]),a=Object(u.a)({onDrop:t}),o=a.getRootProps,i=a.getInputProps,c=a.isDragActive,l=Object(n.useState)(""),d=Object(s.a)(l,2),m=d[0],p=d[1];return r.a.createElement("div",Object.assign({className:"mm-dropzone"},o()),r.a.createElement("input",Object.assign({},i(),{onChange:function(t){console.log(t.target.files),p(Array.prototype.slice.call(t.target.files).map((function(e){return e.name})).join(", ")||""),e.onChange(t)}})),c?r.a.createElement("p",null,"Drop the files here ..."):r.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files"),r.a.createElement("p",null,r.a.createElement("a",{href:"#"},m)))},f=function(e,t,a,n){return{Xb:e+a*Math.sin(n/63.6619772367581),Yb:t+a*Math.cos(n/63.6619772367581)}},b=function(e,t,a,n){var r=Math.abs(a-e),o=Math.abs(n-t),i=Math.sqrt(Math.pow(r,2)+Math.pow(o,2));return Number(i.toFixed(4))},h=function(e,t,a,n){var r=Math.abs(a-e),o=Math.abs(n-t),i=Math.sqrt(Math.pow(r,2)+Math.pow(o,2)),c=a-e,l=n-t,s=63.6619772367581*Math.atan(r/o);if(c>0&&l>0)var d=s;if(c>0&&l<0)d=200-s;if(c<0&&l<0)d=200+s;if(c<0&&l>0)d=400-s;if(0==c&&l>0)d=0;if(0==c&&l<0)d=200;if(c>0&&0==l)d=100;if(c<0&&0==l)d=300;if(0==c&&0==l)d=0;return{Gab:d.toFixed(4),Sab:i.toFixed(4)}},y=a(469),g=a(470),v=a(471),E=a(472),w=a(473),O=a(479),N=a(478),k=a(480),x=a(474),S=a(475),M=a(476),j=a(477),L=(a(221),a(120)),z=a(127),C=a(121),_=function(e,t,a){if(0==a.length)return 0;var n=(b(0,e,0,-50)/(100/99)).toFixed(4)-0,r=(b(0,t,0,50)/(100/99)).toFixed(4)-0,o=Math.floor(n),i=Math.floor(r),c=n-o,l=r-i;if(0==c&&0==l){var s=100*i+o;return Number(a[s][2].toFixed(4))}if(c<=1-l){if(!a[s=100*i+o]||!a[s+1])return 0;var d=a[s][2]-a[s+1][2],m=Math.sqrt(Math.pow(d/150-0,2)+Math.pow(100/99,2)),u=c+l,p=Math.sqrt(Math.pow(l*(100/99),2)+Math.pow(l*(100/99),2)),f=m*u,h=Math.atan(Math.abs((d/150-0)/(100/99))),y=f*Math.sin(h);if(d<0)var g=a[s][2]/150-0+y;else g=a[s][2]/150-0-y;if(!a[s]||!a[s+100])return 0;var v=a[s][2]-a[s+100][2],E=Math.sqrt(Math.pow(v/150-0,2)+Math.pow(100/99,2)),w=l+c,O=Math.sqrt(Math.pow(c*(100/99),2)+Math.pow(c*(100/99),2)),N=E*w,k=Math.atan(Math.abs((v/150-0)/(100/99))),x=N*Math.sin(k);if(v<0)var S=a[s][2]/150-0+x;else S=a[s][2]/150-0-x;var M=p/(O+p),j=Math.abs(g-S)*M;if(g-S<0)var L=g+j;else L=g-j}else{if(!a[s=100*(i+1)+o+1]||!a[s-1])return 0;d=a[s][2]-a[s-1][2],m=Math.sqrt(Math.pow(d/150-0,2)+Math.pow(100/99,2)),u=1-c+(1-l),p=Math.sqrt(Math.pow(100/99*(1-l),2)+Math.pow(100/99*(1-l),2)),f=m*u,h=Math.atan(Math.abs((d/150-0)/(100/99))),y=f*Math.sin(h);if(d<0)g=a[s][2]/150-0+y;else g=a[s][2]/150-0-y;if(!a[s]||!a[s-100])return 0;v=a[s][2]-a[s-100][2],E=Math.sqrt(Math.pow(v/150-0,2)+Math.pow(100/99,2)),w=1-l+(1-c),O=Math.sqrt(Math.pow(100/99*(1-c),2)+Math.pow(100/99*(1-c),2)),N=E*w,k=Math.atan(Math.abs((v/150-0)/(100/99))),x=N*Math.sin(k);if(v<0)S=a[s][2]/150-0+x;else S=a[s][2]/150-0-x;M=p/(O+p),j=Math.abs(g-S)*M;if(g-S<0)L=g+j;else L=g-j}return Number(L.toFixed(4))};function A(e,t,a,n,r,o,i,c,l,s,d){i.FBXLoader=z.a,i.GLTFLoader=C.a;var u=new m.k,p=new m.nb,h=new m.Gb,y=document.getElementById("three-map"),g=document.getElementById("axes-helper");a=new m.pb;var v=new m.pb;a.background=new m.l(0),(n=new m.Lb({antialias:!0,alpha:!0})).setPixelRatio(window.devicePixelRatio),n.setClearColor(0,0),n.setSize(y.clientWidth,y.clientHeight);var E=new m.Lb({antialias:!0,alpha:!0});E.setPixelRatio(window.devicePixelRatio),E.setClearColor(0,0),E.setSize(g.clientWidth,g.clientHeight),y.appendChild(n.domElement),g.appendChild(E.domElement),(e=new m.db(60,y.clientWidth/y.clientHeight,1,1e4)).position.set(80,80,80),e.up.set(0,0,1),(t=new L.a(e,n.domElement)).enableDamping=!0,t.dampingFactor=.05,t.screenSpacePanning=!1,t.minDistance=1,t.maxDistance=1e3,t.maxPolarAngle=Math.PI/2;var w=new m.db(60,g.clientWidth/g.clientHeight,1,1e4);w.position.set(6,6,6),w.lookAt(v.position);var O=new L.a(w,n.domElement);O.enableDamping=!0,O.dampingFactor=.05,O.screenSpacePanning=!1,O.maxPolarAngle=Math.PI/2,O.enablePan=!1,O.enableZoom=!1,O.update(),function(e){for(var t=e.getAttribute("position"),a=t.array,n=2,r=0;n<a.length;n+=3,r++)a[n]=0;t.needsUpdate=!0,e.computeVertexNormals()}(M=new m.eb(100,100,99,99)),(j=new m.U({color:"#222",side:m.o})).flatShading=!0;var N=new m.R(M,j);N.position.set(0,0,0),N.castShadow=!0,N.receiveShadow=!0,a.add(N);var k=new m.v(1e4,1e3);k.geometry.rotateX(Math.PI/2),a.add(k),(x=new m.n(16777215)).position.set(1,1,100),a.add(x);var x=new m.a(16777215);a.add(x);var S=new m.d(5);v.add(S);var M=new m.wb(.5,32,32),j=new m.S({color:"red"});r=new m.R(M,j);M=new m.wb(150,32,32);(new m.Bb).crossOrigin="";M=new m.wb(150,32,32),j=new m.S({opacity:0,transparent:!0,alphaTest:.05,side:m.o});var A=new m.R(M,j);function R(){e.aspect=y.clientWidth/y.clientHeight,e.updateProjectionMatrix(),w.updateProjectionMatrix(),n.setSize(y.clientWidth,y.clientHeight)}return A.rotation.set(Math.PI/2,0,0),a.add(A),function r(){requestAnimationFrame(r),t.update(),O.update(),function(){for(var t=u.getDelta(),r=0;r<window.mergin_mode.mixers.length;++r)window.mergin_mode.mixers[r].update(t);window.mergin_mode.modelLayer.map((function(e){var a=e.mesh.position,n=a.x,r=a.y,o=a.z,i=e.runtimeInfo,c=i.animating,l=i.activeRow,d=window.mergin_mode.vectors.data.filter((function(t){return t.id==e.vectorId}))[0].array[0][l],u=d[0],p=d[1],h=(d[2],d[3]),y=d[4];if(c&&"undefined"!==typeof n&&"undefined"!==typeof r&&"undefined"!==typeof o){var g=window.mergin_mode.plane.dem,v=function(e,t,a,n,r,o){var i=f(e,t,1.2*r,n),c=_(i.Xb,i.Yb,o);return{x:i.Xb,y:i.Yb,z:c}}(Number(n.toFixed(4)),Number(r.toFixed(4)),Number(o.toFixed(4)),h,t,g),E=v.x,w=v.y,O=v.z,N=b(u,p,n,r);if(N===1/0&&(N=0),N<y)e.mesh.position.set(E,w,O);else{var k=window.mergin_mode.vectors.data.filter((function(t){return t.id==e.vectorId}))[0].array[0][l+1];if(k){e.mesh.position.set(k[0],k[1],k[2]),s(e.id,{animating:!0,activeRow:l+1});var x=new m.Hb(0,0,1);e.mesh.rotateOnWorldAxis(x,-(400-d[3]+k[3])/63.6619772367581)}else{var S=window.mergin_mode.vectors.data.filter((function(t){return t.id==e.vectorId}))[0].array[0][0];e.mesh.position.set(S[0],S[1],S[2]),s(e.id,{animating:!1,activeRow:0})}}}})),n.render(a,e),E.render(v,w)}()}(),window.addEventListener("resize",R,!1),document.getElementById("three-map").addEventListener("mousemove",(function(t){var a=document.getElementById("three-map").getBoundingClientRect(),n=a.left,o=a.top;h.x=(t.clientX-n)/y.clientWidth*2-1,h.y=-(t.clientY-o)/y.clientHeight*2+1,p.setFromCamera(h,e);var i=p.intersectObject(N);if(i.length>0){r.position.set(0,0,0),r.lookAt(i[0].face.normal),r.position.copy(i[0].point);var c=Math.sqrt(Math.pow(0,2)+Math.pow(r.position.x- -50,2))/100,l=Math.sqrt(Math.pow(0,2)+Math.pow(-50-r.position.y,2))/100,s=Math.sqrt(Math.pow(0,2)+Math.pow(0-r.position.z,2));d(c,l,s),window.array=window.array||"",window.array+="".concat(r.position.x.toFixed(4),",").concat(r.position.y.toFixed(4),",").concat(r.position.z.toFixed(4),"\n")}}),!1),{camera:e,controls:t,scene:a,renderer:n,pointer:r,partials:{plane:N,pointer:r,sky:A,gridHelper:k},loaders:i,onWindowResize:R}}C.a.prototype.load2=function(e,t){var a=this,n=e[0],r=new FileReader;r.onload=function(e){2!==e.target.readyState&&0!==e.target.status||a.parse(e.target.result||e.target.responseText,"",t)},r.readAsArrayBuffer(n)},z.a.prototype.load2=function(e,t){var a=this,n=e[0],r=new FileReader;r.onload=function(e){if(2===e.target.readyState||0===e.target.status){var n=a.parse(e.target.result||e.target.responseText);t&&t(n)}},r.readAsArrayBuffer(n)};var R=a(78),D=a(79),I=a.n(D),T=(a(229),a(230),a(206)),F=a(57),P=a(198),H=a(59),B=a(58),W=a(60),G=a(56),J=function(e){function t(e){var a;Object(F.a)(this,t),a=Object(H.a)(this,Object(B.a)(t).call(this,e));e.keys;return a.state={clicked:!1,color:"#000"},a}return Object(W.a)(t,e),Object(P.a)(t,[{key:"render",value:function(){return this.state.clicked?r.a.createElement(G.SketchPicker,null):r.a.createElement("div",{style:{backgroundColof:this.state.color,border:"3px solid whitesmoke",borderRadius:"4px",width:"16px",height:"16px",float:"right"}})}}]),t}(r.a.Component);J.defaultProps={};var U=a(4),q=a(123),V=a(199),X=function(e){return{type:"LOAD_MODEL",model:e,id:Date.now()}},Y=function(e){return{type:"SET_PLANE",plane:e,id:Date.now()}},K=function(e){return{type:"CHANGE_SECTION",section:e}},Z=function(e){return{type:"SET_LAYERS",layers:e}},$=function(e){return{type:"SET_MODEL_LAYER",layer:e}},Q=function(e,t){var a=e.name.split("-")[0],n=e.name.split("-")[1];"background"===a?"color"===n?e.scene.background=t?new m.l(e.backgroundColor):null:"image"===n&&(e.sky.visible=t):"ground"===a&&"grid"==n&&(e.gridHelper.visible=t)},ee=function(e,t){var a=e.d,n=e.scale,r=e.rotation,o=e.vector,i=t.vectors.filter((function(e){return e.id==o[a.id]}))[0];if(!i)return!1;if(i.name.toLowerCase().includes("anime")){var c,s;if(a.name.toLowerCase().includes("glb")||a.name.toLowerCase().includes("gltf")){var d=z(s=q.a.clone(a.mesh.scene),a.mesh.animations,"Take 001");window.mergin_mode.mixers.push(d)}else{d=z((s=a.mesh.clone()).children[0],a.mesh.animations,"Take 001");window.mergin_mode.mixers.push(d)}var u=JSON.parse(r[a.id]);u.x=Number(u.x),u.y=Number(u.y),u.z=Number(u.z);var p=JSON.parse(n[a.id]);p.x=Number(p.x),p.y=Number(p.y),p.z=Number(p.z);var f=new m.Hb(1,0,0),b=new m.Hb(0,1,0),h=new m.Hb(0,0,1);s.rotateOnWorldAxis(f,u.x),s.rotateOnWorldAxis(b,u.y),s.rotateOnWorldAxis(h,-i.array[0][0][3]/63.6619772367581),s.scale.set(p.x,p.y,p.z),(c=s.position).set.apply(c,Object(l.a)(i.array[0][0])),s.castShadow=!0,s.receiveShadow=!0,t.scene.add(s),t.setModelLayer({id:Date.now(),vectorId:i.id,runtimeInfo:{animating:!0,activeRow:0},mesh:s})}else{var y;if(y=a.name.toLowerCase().includes("glb")||a.name.toLowerCase().includes("gltf")?q.a.clone(a.mesh.scene):a.mesh.clone(),i.array[0].length>2){for(var g=new V.a(y,i.array[0].length),v=0;v<i.array[0].length-1;v++){var E,w=new m.bb;w.frustumCulled=!1;var O=JSON.parse(r[a.id]);O.x=Number(O.x),O.y=Number(O.y),O.z=Number(O.z);var N=new m.Hb(1,0,0),k=new m.Hb(0,1,0),x=new m.Hb(0,0,1);w.rotateOnWorldAxis(N,O.x),w.rotateOnWorldAxis(k,O.y),w.rotateOnWorldAxis(x,2*Math.random()*Math.PI);var S=.1*Math.random(),M=.1*Math.random()+.05,j=JSON.parse(n[a.id]);j.x=Number(j.x)+S,j.y=Number(j.y)+S,j.z=Number(j.z)+M,w.scale.set(j.x,j.y,j.z),(E=w.position).set.apply(E,Object(l.a)(i.array[0][v])),w.updateMatrix(),g.setMatrixAt(v,w.matrix)}t.scene.add(g)}else i.array[0].map((function(e){var o;if(0==e.length)return!1;i.name.includes("new")?y.traverse((function(e){e.isMesh&&(e.material.transparent=!0,e.material.opacity=.7,e.material.needsUpdate=!0)})):y.traverse((function(e){e.isMesh&&(e.material.transparent=!0,e.material.opacity=.9,e.material.needsUpdate=!0)}));var c=JSON.parse(r[a.id]);c.x=Number(c.x),c.y=Number(c.y),c.z=Number(c.z);var s=new m.Hb(1,0,0),d=new m.Hb(0,1,0),u=new m.Hb(0,0,1);y.rotateOnWorldAxis(s,c.x),y.rotateOnWorldAxis(d,c.y),y.rotateOnWorldAxis(u,c.z);var p=JSON.parse(n[a.id]);p.x=Number(p.x),p.y=Number(p.y),p.z=Number(p.z),y.rotation.set(c.x,c.y,c.z),y.scale.set(p.x,p.y,p.z),(o=y.position).set.apply(o,Object(l.a)(e)),y.castShadow=!0,y.receiveShadow=!0,window.meshes=window.meshes||[],window.meshes.push(y),t.scene.add(y)}))}var L=Object(l.a)(t.layers);function z(e,t,a){var n=new m.c(e),r=m.b.findByName(t,a);r&&n.clipAction(r).play();return n}L[1].children[3].children.push({key:"1-3-".concat(L[1].children[3].children.length),title:a.name+"_"+i.name,checkable:!0,selectable:!1}),t.setLayers(L)},te=function(e){return function(t,a){var n=a(),r={vectors:n.api.vectors.data,plane:n.api.plane.mesh},o=r.vectors.filter((function(t){return t.id==e}))[0];if(!o)return!1;o=o.array[0];var i,c=r.plane.geometry.attributes.position.array;i=0;for(var l=o.length-2,s={x:Number(o[0][0]),y:Number(o[0][1]),z:Number(o[0][2])},d={x:Number(o[l][0]),y:Number(o[l][1]),z:Number(o[l][2])},u=0;u<=l;u++)i++,i++,c[i++]=((o[u]||[])[2]||0)-50,s.z>Number(o[u][2])&&(s.z=Number(o[u][2])),d.z<Number(o[u][2])&&(d.z=Number(o[u][2]));r.plane.geometry.attributes.position.needsUpdate=!0;var p=new m.Bb;p.crossOrigin="",p.load("../assets/cropped.png",(function(e){var t=new m.S({map:e});r.plane.material=t,r.plane.material.needsUpdate=!0}),(function(){}),(function(e){console.log(e)}));var f=new m.U({color:"#000",polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});r.plane.material=f,r.plane.material.needsUpdate=!0,t(Y({dem:o,coords:{min:s,max:d}}))}};var ae=Object(d.b)((function(e){return{layers:e.api.layers,scene:e.api.scene,sky:e.api.sky.mesh,gridHelper:e.api.plane.gridHelper,backgroundColor:e.api.background.color}}),(function(e){return{changeSection:function(t){return e(K(t))},toggleLayer:Q}}))((function(e){var t=e.keys,a=t,o=Object(n.useState)(e.layers),i=Object(s.a)(o,2),l=i[0],d=i[1];return Object(n.useEffect)((function(){d(e.layers)}),[e.layers]),r.a.createElement("span",{className:"cus-label"},r.a.createElement("span",null,"operations: "),r.a.createElement("span",{style:{color:"blue"},onClick:function(){setTimeout((function(){}),0)}},"Edit"),"\xa0",r.a.createElement("label",{onClick:function(e){return e.stopPropagation()}},r.a.createElement("input",{type:"checkbox"})," checked"),"\xa0",r.a.createElement("span",{style:{color:"#EB0000"},onClick:function(e){window.confirm("sure to delete?")&&e.stopPropagation()}},"Delete")),r.a.createElement("div",{className:"layers-panel",style:{margin:"0 20px"}},r.a.createElement(T.a,{className:"myCls",showLine:!0,checkable:!0,multiple:!1,checkStrictly:!0,selectable:!0,defaultExpandAll:!0,onExpand:function(e){console.log("onExpand",e)},defaultSelectedKeys:[],defaultCheckedKeys:a,onSelect:function(t,a){var n=a.node.key;console.log("selected",t,a),e.changeSection(t.length?n:null)},onCheck:function(t,a){console.log("onCheck",t,a),Q(Object(c.a)({name:a.node.key},e),a.checked)},treeData:l}))})),ne=a(200),re=a(124);a(439);var oe=Object(d.b)((function(e){return{models:e.api.models,title:e.api.section.title,scene:e.api.scene,vectors:e.api.vectors.data,layers:e.api.layers}}),(function(e){return{loadModel:function(t){return e(X(t))},changeSection:function(t){return e(K(t))},setModelLayer:function(t){return e($(t))},setLayers:function(t){return e(Z(t))},addModel:function(e,t){return ee(e,t)}}}))((function(e){var t=Object(n.useState)({}),a=Object(s.a)(t,2),o=a[0],i=a[1],l=Object(n.useState)(JSON.stringify({})),d=Object(s.a)(l,2),m=d[0],u=d[1],p=Object(n.useState)(JSON.stringify({})),f=Object(s.a)(p,2),b=f[0],h=f[1],y=Object(n.useState)(JSON.stringify({})),g=Object(s.a)(y,2),v=g[0],E=g[1],w=Object(n.useState)({}),O=Object(s.a)(w,2),N=O[0],k=O[1];Object(n.useEffect)((function(){var t={},a={},n={},r={},c={};e.models.data.map((function(e){t[e.id]=m[e.id]||JSON.stringify({x:0,y:0,z:0}),a[e.id]=v[e.id]||JSON.stringify({x:0,y:0,z:0}),n[e.id]=b[e.id]||JSON.stringify({x:1,y:1,z:1}),r[e.id]=o[e.id]||"info",c[e.id]=N[e.id]||0})),u(t),E(a),h(n),i(r),k(c)}),[e.models.data]);var x=function(e,t,a,n){return e(Object(c.a)({},a,Object(U.a)({},t,n)))};return r.a.createElement("div",{className:"ModelList container"},r.a.createElement("div",{className:"row"},e.models.data.map((function(t){return r.a.createElement("div",{className:"col-md-6 col-sm-6 col-xs-12"},r.a.createElement("div",{className:"model-item"},"info"===o[t.id]?r.a.createElement("span",{className:"settings",onClick:function(){return x(i,t.id,o,"settings")}},r.a.createElement("i",{className:"fas fa-cog"})):r.a.createElement("span",{className:"settings",onClick:function(){return x(i,t.id,o,"info")}},r.a.createElement("i",{className:"fas fa-arrow-right"})),"info"===o[t.id]?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mm-form-block"},r.a.createElement("div",null,"id: ",t.id),r.a.createElement("div",null,"name: ",t.name),r.a.createElement("div",null,"size: ",(t.size/1e3/1e3).toFixed(2)," Mb")),r.a.createElement("button",{className:"mm-btn",onClick:function(a){return e.addModel({d:t,scale:b,rotation:v,vector:N},e)}},"Add To Scene")):r.a.createElement(r.a.Fragment,null,r.a.createElement("label",null,"Rotation"),r.a.createElement("input",{onChange:function(e){return x(E,t.id,v,e.target.value)},value:v[t.id]}),r.a.createElement("label",null,"Scale"),r.a.createElement("input",{onChange:function(e){return x(h,t.id,b,e.target.value)},value:b[t.id]}),r.a.createElement("label",null,"Position"),r.a.createElement("select",{onChange:function(e){x(k,t.id,N,e.target.value)}},r.a.createElement("option",{value:0,selected:0==N[t.id]},"Select"),e.vectors.map((function(e){return r.a.createElement("option",{value:e.id,selected:N[t.id]==e.id},e.name)}))))))}))))}));var ie=Object(d.b)((function(e){return{models:e.api.models,title:e.api.section.title,scene:e.api.scene,vectors:e.api.vectors.data,layers:e.api.layers}}),(function(e){return{loadModel:function(t){return e(X(t))},changeSection:function(t){return e(K(t))},setModelLayer:function(t){return e($(t))},setLayers:function(t){return e(Z(t))}}}))((function(e){return r.a.createElement("div",{className:"Background container"},r.a.createElement("div",{className:"row"},"Background"))}));var ce=Object(d.b)((function(e){return{models:e.api.models,title:e.api.section.title,scene:e.api.scene,vectors:e.api.vectors.data,plane:e.api.plane.mesh,coords:e.api.plane.coords}}),(function(e){return{setPlane:function(t,a){return e(Y({dem:t,coords:a}))},loadGround:function(t){return e(te(t))}}}))((function(e){var t=Object(n.useState)(0),a=Object(s.a)(t,2),o=a[0];return a[1],r.a.createElement("div",{className:"ModelList container"},r.a.createElement("h3",null,e.title),r.a.createElement("select",{onChange:function(t){e.loadGround(t.target.value,e)}},r.a.createElement("option",{value:0,selected:0==o},"Select"),e.vectors.map((function(e){return r.a.createElement("option",{value:e.id,selected:o==e.id},e.name)}))))})),le=(a(440),a(201));function se(e){return r.a.createElement(le.Carousel,{centerMode:!0,centerSlidePercentage:33,emulateTouch:!0},e.slides.map((function(t){return r.a.createElement("div",null,r.a.createElement("img",{src:t.src,className:"mm-image mm-slider-img"}),r.a.createElement("p",{className:"legend mm-btn",onClick:function(a){return function(t,a){t.stopPropagation(),e.onClick(a)}(a,t.src)}},"Use ",t.legend))})))}var de=Object(d.b)((function(e){return{models:e.api.models,title:e.api.section.title,scene:e.api.scene,sky:e.api.sky.mesh,vectors:e.api.vectors.data,layers:e.api.layers}}),(function(e){return{loadModel:function(t){return e(X(t))},changeSection:function(t){return e(K(t))},setModelLayer:function(t){return e($(t))},setLayers:function(t){return e(Z(t))}}}))((function(e){return r.a.createElement("div",{className:"Images container"},r.a.createElement("div",{className:"row"},r.a.createElement(se,{onClick:function(t){if("../assets/banned.png"===t)return e.sky.material=new m.S({opacity:0,transparent:!0,alphaTest:.05,side:m.o}),e.sky.material.needsUpdate=!0,!0;var a=new m.Bb;a.crossOrigin="",a.load(t,(function(t){e.sky.material=new m.S({map:t,side:m.e}),e.sky.material.needsUpdate=!0}),(function(){}),(function(e){console.log(e)}))},slides:[{src:"../assets/banned.png",legend:"No Image"},{src:"../assets/sky.jpg",legend:"Sky"},{src:"../assets/night-sky.jpg",legend:"Night Sky"},{src:"../assets/fantasy.jpg",legend:"Fantasy Sky"}]})))}));var me=Object(d.b)((function(e){return{models:e.api.models,title:e.api.section.title,scene:e.api.scene,plane:e.api.plane.mesh,vectors:e.api.vectors.data,layers:e.api.layers,backgroundColor:e.api.background.color,groundColor:e.api.plane.color}}),(function(e){return{loadModel:function(t){return e(X(t))},changeSection:function(t){return e(K(t))},setModelLayer:function(t){return e($(t))},setLayers:function(t){return e(Z(t))},setBackgroundColor:function(t){return e(function(e){return{type:"SET_BACKGROUND_COLOR",color:e}}(t))},setGroundColor:function(t){return e(function(e){return{type:"SET_GROUND_COLOR",color:e}}(t))}}}))((function(e){var t=Object(n.useState)("background"===e.type?e.backgroundColor:e.groundColor),a=Object(s.a)(t,2),o=a[0],i=a[1];return Object(n.useEffect)((function(){return i("background"===e.type?e.backgroundColor:e.groundColor)}),[e.type]),r.a.createElement("div",{className:"Color container"},r.a.createElement("div",{className:"row"},r.a.createElement(G.ChromePicker,{color:o,onChange:function(t){i(t.hex),"background"===e.type?(e.setBackgroundColor(t.hex),e.scene.background=new m.l(t.hex)):(e.setGroundColor(t.hex),e.plane.material.color=new m.l(t.hex))}})))}));I.a.setAppElement("#root");var ue=Object(d.b)((function(e){return{section:e.api.section.active,title:e.api.section.title,layers:e.api.layers,vectors:e.api.vectors,modelLayer:e.api.modelLayer,coords:e.api.plane.coords,state:e.api}}),(function(e){return{loadModel:function(t){return e(X(t))},loadVector:function(t){return e(function(e){return{type:"LOAD_VECTOR",vector:e,id:Date.now()}}(t))},changeSection:function(t){return e(K(t))},setScene:function(t){return e(function(e){return{type:"SET_SCENE",scene:e,id:Date.now()}}(t))},setPlane:function(t){return e(Y(t))},setSky:function(t){return e(function(e){return{type:"SET_SKY",sky:e,id:Date.now()}}(t))},setLayers:function(t){return e(Z(t))},showCoords:function(t,a,n){return e(function(e,t,a){return function(n,r){var o=r().api.plane.coords,i=o.max.x-o.min.x,c=o.max.y-o.min.y;document.getElementById("coords").innerHTML="".concat((e*i+o.min.x).toFixed(2),", ").concat((t*c+o.min.y).toFixed(2),",").concat((o.min.z+a).toFixed(2))}}(t,a,n))},addModel:function(e,t){return ee(e,t)},loadDemo:function(t,a){return e(function(e,t){return function(a,n){t([{name:"loutro-old.glb",size:"0",url:"/demo/loutro-old.glb"},{name:"tree-green.fbx",size:"0",url:"/demo/tree-green.fbx"},{name:"tree-red.fbx",size:"0",url:"/demo/tree-red.fbx"},{name:"loutro-new.gltf",size:"0",url:"/demo/loutro-new.gltf"},{name:"loutro-old.csv",size:"0",url:"/demo/loutro-old.csv"},{name:"loutro-new.csv",size:"0",url:"/demo/loutro-new.csv"},{name:"trees-green.csv",size:"0",url:"/demo/trees-green.csv"},{name:"trees-red.csv",size:"0",url:"/demo/trees-red.csv"},{name:"dtm.csv",size:"0",url:"/demo/dtm.csv"}]).then((function(){var t,a,r,o,i=n();t=i.api.models.data.filter((function(e){return"tree-green.fbx"===e.name}))[0],a=Object(U.a)({},t.id,i.api.vectors.data.filter((function(e){return"trees-green.csv"===e.name}))[0].id),r=Object(U.a)({},t.id,JSON.stringify({x:1.57,y:0,z:0})),o=Object(U.a)({},t.id,JSON.stringify({x:.1,y:.1,z:.1})),e.addModel({d:t,scale:o,rotation:r,vector:a},Object(c.a)({},e,{section:i.api.section.active,title:i.api.section.title,layers:i.api.layers,vectors:i.api.vectors.data,modelLayer:i.api.modelLayer,coords:i.api.plane.coords,state:i.api,scene:i.api.scene})),t=i.api.models.data.filter((function(e){return"tree-red.fbx"===e.name}))[0],a=Object(U.a)({},t.id,i.api.vectors.data.filter((function(e){return"trees-red.csv"===e.name}))[0].id),r=Object(U.a)({},t.id,JSON.stringify({x:1.57,y:0,z:0})),o=Object(U.a)({},t.id,JSON.stringify({x:.1,y:.1,z:.1})),e.addModel({d:t,scale:o,rotation:r,vector:a},Object(c.a)({},e,{section:i.api.section.active,title:i.api.section.title,layers:i.api.layers,vectors:i.api.vectors.data,modelLayer:i.api.modelLayer,coords:i.api.plane.coords,state:i.api,scene:i.api.scene}));var l=new m.Bb;l.crossOrigin="",l.load("../assets/fantasy.jpg",(function(e){i.api.sky.mesh.material=new m.S({map:e,side:m.e}),i.api.sky.mesh.material.needsUpdate=!0}),(function(){}),(function(e){console.log(e)})),e.loadGround(i.api.vectors.data.filter((function(e){return"dtm.csv"===e.name}))[0].id,e),t=i.api.models.data.filter((function(e){return"loutro-old.glb"===e.name}))[0],a=Object(U.a)({},t.id,i.api.vectors.data.filter((function(e){return"loutro-old.csv"===e.name}))[0].id),r=Object(U.a)({},t.id,JSON.stringify({x:1.57,y:0,z:0})),o=Object(U.a)({},t.id,JSON.stringify({x:1.1,y:1.1,z:1.1})),e.addModel({d:t,scale:o,rotation:r,vector:a},Object(c.a)({},e,{section:i.api.section.active,title:i.api.section.title,layers:i.api.layers,vectors:i.api.vectors.data,modelLayer:i.api.modelLayer,coords:i.api.plane.coords,state:i.api,scene:i.api.scene})),t=i.api.models.data.filter((function(e){return"loutro-new.gltf"===e.name}))[0],a=Object(U.a)({},t.id,i.api.vectors.data.filter((function(e){return"loutro-new.csv"===e.name}))[0].id),r=Object(U.a)({},t.id,JSON.stringify({x:1.57,y:0,z:0})),o=Object(U.a)({},t.id,JSON.stringify({x:11,y:11,z:11})),e.addModel({d:t,scale:o,rotation:r,vector:a},Object(c.a)({},e,{section:i.api.section.active,title:i.api.section.title,layers:i.api.layers,vectors:i.api.vectors.data,modelLayer:i.api.modelLayer,coords:i.api.plane.coords,state:i.api,scene:i.api.scene}))}))}}(t,a))},loadGround:function(t,a){return e(te(t))},setModelRuntimeInfo:function(t,a){return e(function(e,t){return{type:"SET_MODEL_RUNTIME_INFO",modelId:e,runtimeInfo:Object(c.a)({},t)}}(t,a))}}}))((function(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),o=a[0],i=a[1],d=Object(n.useState)(!1),m=Object(s.a)(d,2),u=m[0],f=m[1],b=Object(n.useState)([]),L=Object(s.a)(b,2),z=L[0],C=L[1],_=Object(n.useState)({mixers:[],camera:{},controls:{},scene:{},renderer:{},pointer:{},partials:{},loaders:{},onWindowResize:function(){}}),D=Object(s.a)(_,2),T=D[0],F=D[1],P=function(){return f(!u)},H=function(t,a){var n=t[0],r=n.name,o=n.size,i=n.url,c=(T.scene,new T.loaders.GLTFLoader),s=new ne.a;c.setDRACOLoader(s),i?c.load(i,(function(t){t.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0)})),e.loadModel({name:r,size:o,object:t}),f(!1);var n=Object(l.a)(e.layers);n[0].children.push({key:"0-".concat(n[0].children.length),title:r,checkable:!1,selectable:!1}),e.setLayers(n),a(!0)})):c.load2(t,(function(t){t.scene.traverse((function(e){e.isMesh&&(e.castShadow=!0)})),e.loadModel({name:r,size:o,object:t}),f(!1);var a=Object(l.a)(e.layers);a[0].children.push({key:"0-".concat(a[0].children.length),title:r,checkable:!1,selectable:!1}),e.setLayers(a)}))},B=function(t,a){var n=t[0],r=n.name,o=n.size,i=n.url,c=(T.scene,new T.loaders.FBXLoader);i?c.load(i,(function(t){t.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),e.loadModel({name:r,size:o,object:t}),f(!1);var n=Object(l.a)(e.layers);n[0].children.push({key:"0-".concat(n[0].children.length),title:r,checkable:!1,selectable:!1}),e.setLayers(n),a(!0)})):c.load2(t,(function(t){t.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),e.loadModel({name:r,size:o,object:t}),f(!1);var a=Object(l.a)(e.layers);a[0].children.push({key:"0-".concat(a[0].children.length),title:r,checkable:!1,selectable:!1}),e.setLayers(a)}))};Object(n.useEffect)((function(){T.mixers;var t=T.camera,a=T.controls,n=T.scene,r=T.renderer,o=T.pointer,i=(T.partials,T.loaders),l=(document.getElementById("three-map"),A(t,a,n,r,o,0,i,0,0,e.setModelRuntimeInfo,e.showCoords));e.setScene(l.scene),e.setPlane({id:Date.now(),mesh:l.partials.plane,gridHelper:l.partials.gridHelper}),e.setSky({id:Date.now(),mesh:l.partials.sky}),F(Object(c.a)({},l))}),[]);var W,G=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=[],n=t.length>0?t:Array.prototype.slice.call(z);return 0!=n.length&&(t.length>0?(n.map((function(t){a.push(new Promise((function(a,n){var o=t.name.split(".")[t.name.split(".").length-1].toLowerCase();["xlsx","xls","ods","csv","xyz"].indexOf(o)>-1?fetch(t.url).then((function(e){return e.text()})).then((function(n){var o=[n.split("\n").map((function(e){return e.split(",")}))];o[0][o[0].length-1]=[];var i=t.name,c=t.size,s=Object(l.a)(e.layers);if(s[1].children[2].children.push({key:"1-2-".concat(s[1].children[2].children.length),title:i,checkable:!0,selectable:!1,icon:r.a.createElement("span",null)}),e.setLayers(s),i.includes("anime")){for(var d=0;d<o[0].length-1;d++){var m=o[0][d][0],u=o[0][d][1],p=(o[0][d+1]||[])[0]||0,f=(o[0][d+1]||[])[1]||0,b=h(m,u,p,f),y=b.Gab,g=b.Sab;o[0][d][3]=Number(y),o[0][d][4]=Number(g)}e.loadVector({name:i,size:c,array:o})}else e.loadVector({name:i,size:c,array:o});a(!0)})).catch((function(e){a(!0),console.log(e)})):"fbx"==o?B([t],a):"glb"!==o&&"gltf"!==o||H([t],a)})))})),Promise.all(a)):(n.map((function(t){var a=t.name.split(".")[t.name.split(".").length-1].toLowerCase();if(["xlsx","xls","ods","csv","xyz"].indexOf(a)>-1){var n=new FileReader,o=[];n.onload=function(a){var n=a.target.result,i=re.read(n,{type:"binary"}),c=i.SheetNames[0],s=i.Sheets[c],d=re.utils.sheet_to_csv(s,{header:1});o.push(d.split("\n").map((function(e){return e.split(",").filter((function(e){return e.length>0})).map((function(e){return Number(e)}))})));var m=t.name,u=t.size,p=Object(l.a)(e.layers);if(p[1].children[2].children.push({key:"1-2-".concat(p[1].children[2].children.length),title:m,checkable:!0,selectable:!1,icon:r.a.createElement("span",null)}),e.setLayers(p),m.includes("anime")){for(var f=0;f<o[0].length-1;f++){var b=o[0][f][0],y=o[0][f][1],g=(o[0][f+1]||[])[0]||0,v=(o[0][f+1]||[])[1]||0,E=h(b,y,g,v),w=E.Gab,O=E.Sab;o[0][f][3]=Number(w),o[0][f][4]=Number(O)}e.loadVector({name:m,size:u,array:o})}else e.loadVector({name:m,size:u,array:o})},n.readAsBinaryString(t),f(!1)}else"fbx"==a?B([t]):"glb"!==a&&"gltf"!==a||H([t])})),void C([])))};return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement(y.a,{expand:"md",className:"navbar navbar-dark"},r.a.createElement(g.a,{href:"#"},r.a.createElement("div",{className:"logo-container"},r.a.createElement("div",{className:"logo"}))),r.a.createElement(v.a,{onClick:function(){return i(!o)}}),r.a.createElement(E.a,{isOpen:o,navbar:!0},r.a.createElement(w.a,{className:"mr-auto",navbar:!0},r.a.createElement(O.a,{nav:!0,inNavbar:!0},r.a.createElement(N.a,{nav:!0,caret:!0},"File"),r.a.createElement(k.a,{right:!0},r.a.createElement(x.a,{onClick:P},r.a.createElement("span",null,"Import ")),r.a.createElement(x.a,{divider:!0}))),r.a.createElement(S.a,null,r.a.createElement(M.a,{onClick:function(){return e.loadDemo(e,G)}},"Load Demo"))),r.a.createElement(j.a,null,r.a.createElement(M.a,{href:"https://github.com/prieston/mergin_mode",target:"_blank"},r.a.createElement("i",{className:"fab fa-github"}),r.a.createElement("span",null,"GitHub")))))),r.a.createElement("main",null,r.a.createElement(R.a,{split:"vertical",minSize:50,maxSize:-50,defaultSize:"40%",onChange:T.onWindowResize},r.a.createElement(ae,{keys:["background-color","background-image","ground-grid","ground-color"]}),r.a.createElement(R.a,{split:"horizontal",minSize:50,maxSize:-50,defaultSize:"60%",onChange:T.onWindowResize},r.a.createElement("div",{id:"three-map"},r.a.createElement("div",{id:"axes-helper"}),r.a.createElement("div",{id:"info-helper"},r.a.createElement("div",{id:"epsg"},"EPSG: 32634"),r.a.createElement("div",{id:"coords"}))),null!==e.section&&("models"===(W=e.section)?r.a.createElement(oe,null):"background"===W?r.a.createElement(ie,null):"background-color"===W?r.a.createElement(me,{type:"background"}):"background-image"===W?r.a.createElement(de,{type:"background"}):"ground-color"===W?r.a.createElement(me,{type:"ground"}):"ground-image"===W?r.a.createElement(de,{type:"ground"}):"ground-vertices"===W?r.a.createElement(ce,null):r.a.createElement("span",null))||r.a.createElement("span",null)))),r.a.createElement(I.a,{isOpen:u,onRequestClose:function(){return f(!u)}},r.a.createElement("div",{className:"container form"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-12"},r.a.createElement(p,{onChange:function(e){C(Object(l.a)(e.target.files))}}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("button",{className:"btn btn-primary form-control",onClick:G},"Load")),r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("button",{className:"btn btn-secondary form-control",onClick:P},"Close"))))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var pe=a(39),fe=a(204),be=a(205);window.mergin_mode={modelLayer:[],vectors:[],plane:{},sky:{},mixers:[]};var he={layers:[{key:"models",title:"Models",checkable:!1,selectable:!0,icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-folder"})),children:[]},{key:"scene",title:"Scene",checkable:!1,selectable:!1,icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-folder"})),children:[{key:"background",title:"Background",checkable:!1,icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-folder"})),children:[{key:"background-color",title:"Color",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"fas fa-palette"}))},{key:"background-image",title:"Image",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-file-image"}))},{key:"background-video",title:"Video",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-file-video"}))}]},{key:"ground",title:"Ground",checkable:!1,icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-folder"})),selectable:!1,children:[{key:"ground-color",title:"Color",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"fas fa-palette"}))},{key:"ground-image",title:"Image",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-file-image"}))},{key:"ground-vertices",title:"Vertices",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"fas fa-mountain"}))},{key:"ground-grid",title:"Grid",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"fab fa-slack-hash"}))}]},{key:"vector-layers",title:"Vector Layers",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-folder"})),checkable:!1,selectable:!1,children:[]},{key:"model-layers",title:"Model Layers",icon:r.a.createElement("span",{className:"layer-icon"},r.a.createElement("i",{className:"far fa-folder"})),checkable:!1,selectable:!1,children:[]}]}],scene:{},plane:{id:null,mesh:{},dem:[],coords:{min:{x:-50,y:-50,z:0},max:{x:50,y:50,z:0}},color:"#222",gridHelper:{}},sky:{id:null,mesh:{}},background:{color:"#000"},models:{data:[]},vectors:{data:[]},modelLayer:[],section:{active:null,title:null}},ye={models:"Models"},ge=Object(pe.c)({api:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_MODEL":return Object.assign({},e,{models:Object.assign({},e.models,{data:[].concat(Object(l.a)(e.models.data),[{id:t.id,mesh:t.model.object,name:t.model.name,size:t.model.size}])})});case"LOAD_VECTOR":var a=Object.assign({},e,{vectors:Object.assign({},e.vectors,{data:[].concat(Object(l.a)(e.vectors.data),[{id:t.id,array:t.vector.array,name:t.vector.name,size:t.vector.size}])})});return window.mergin_mode.vectors=a.vectors,a;case"CHANGE_SECTION":return Object.assign({},e,{section:Object.assign({},e.section,{active:t.section,title:ye[t.section]||null})});case"SET_SCENE":return Object.assign({},e,{scene:t.scene});case"SET_PLANE":var n=Object.assign({},e,{plane:Object(c.a)({},e.plane,{},t.plane)});return window.mergin_mode.plane=n.plane,n;case"SET_SKY":var r=Object.assign({},e,{sky:Object(c.a)({},e.sky,{},t.sky)});return window.mergin_mode.sky=r.sky,r;case"SET_LAYERS":return Object.assign({},e,{layers:t.layers});case"SET_BACKGROUND_COLOR":return Object.assign({},e,{background:{color:t.color}});case"SET_GROUND_COLOR":return Object.assign({},e,{plane:Object(c.a)({},e.plane,{color:t.color})});case"SET_MODEL_LAYER":var o=Object.assign({},e,{modelLayer:[].concat(Object(l.a)(e.modelLayer),[t.layer])});return window.mergin_mode.modelLayer=o.modelLayer,o;case"SET_MODEL_RUNTIME_INFO":var i=Object.assign({},e,{modelLayer:Object(l.a)(e.modelLayer.map((function(e){return e.id==t.modelId&&(e.runtimeInfo=t.runtimeInfo),e})))});return window.mergin_mode.modelLayer=i.modelLayer,i;default:return e}}}),ve=document.getElementById("root"),Ee=Object(fe.createLogger)({}),we=Object(pe.d)(ge,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),Object(pe.a)(be.a,Ee));i.a.render(r.a.createElement(d.a,{store:we},r.a.createElement(ue,null)),ve),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[209,1,2]]]);
//# sourceMappingURL=main.49acc0a9.chunk.js.map