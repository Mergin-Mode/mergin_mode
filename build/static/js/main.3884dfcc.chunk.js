(this.webpackJsonp3drw=this.webpackJsonp3drw||[]).push([[0],{177:function(e,t){},198:function(e,t,a){e.exports=a(450)},203:function(e,t,a){},205:function(e,t,a){},218:function(e,t,a){},425:function(e,t){},426:function(e,t){},427:function(e,t,a){},450:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(24),i=a.n(c),l=(a(203),a(204),a(38)),o=a(76),s=a(14),d=(a(205),a(23)),u=a(452),m=a(453),p=a(454),f=a(455),b=a(456),E=a(461),h=a(460),v=a(462),g=a(457),y=a(458),O=a(459),S=a(2),w=a(186),N=a(124);function j(e,t,a,n,r,c,i,l){i.FBXLoader=N.a;new S.g;var o=new S.N,s=new S.Z,d=document.getElementById("three-map");(a=new S.P).background=new S.h(0),(n=new S.eb({antialias:!0})).setPixelRatio(window.devicePixelRatio),n.setSize(d.clientWidth,d.clientHeight),n.shadowMap.enabled=!0,document.getElementById("three-map").appendChild(n.domElement),(e=new S.H(60,d.clientWidth/d.clientHeight,1,1e4)).position.set(80,80,80),e.up.set(0,0,1),(t=new w.a(e,n.domElement)).enableDamping=!0,t.dampingFactor=.05,t.screenSpacePanning=!1,t.minDistance=10,t.maxDistance=1e3,t.maxPolarAngle=Math.PI/2,function(e){for(var t=e.getAttribute("position"),a=t.array,n=2,r=0;n<a.length;n+=3,r++)a[n]=0;t.needsUpdate=!0,e.computeVertexNormals()}(f=new S.I(100,100,100,100)),(b=new S.D({color:"#222",side:S.l})).flatShading=!0;var u=new S.A(f,b);u.position.set(0,0,0),u.castShadow=!0,u.receiveShadow=!0,a.add(u),(p=new S.j(16777215)).position.set(1,1,100),p.shadow={camera:{near:.5,far:300,left:-50,bottom:-50,right:50,top:50},bias:1e-4,mapSize:{x:6144,y:6144}},a.add(p);var m=new S.k(p,5);a.add(m),(p=new S.j(8840)).position.set(-0,-0,-100),a.add(p);m=new S.k(p,5);a.add(m);var p=new S.a(6710886);a.add(p);var f=new S.S(1,32,32),b=new S.B({color:16711680});function E(){console.log("in"),e.aspect=d.clientWidth/d.clientHeight,e.updateProjectionMatrix(),n.setSize(d.clientWidth,d.clientHeight)}return r=new S.A(f,b),a.add(r),function r(){requestAnimationFrame(r),t.update(),n.render(a,e)}(),window.addEventListener("resize",E,!1),window.addEventListener("mousedown",(function(t){var a=document.getElementById("three-map").getBoundingClientRect(),n=a.left,c=a.top;s.x=(t.clientX-n)/d.clientWidth*2-1,s.y=-(t.clientY-c)/d.clientHeight*2+1,o.setFromCamera(s,e);var i=o.intersectObject(u);i.length>0&&(r.position.set(0,0,0),r.lookAt(i[0].face.normal),r.position.copy(i[0].point))}),!1),{camera:e,controls:t,scene:a,renderer:n,pointer:r,partials:{plane:u,pointer:r},loaders:i,onWindowResize:E}}N.a.prototype.load2=function(e,t){var a=this,n=e[0],r=new FileReader;r.onload=function(e){if(2===e.target.readyState||0===e.target.status){var n=a.parse(e.target.result||e.target.responseText);t&&t(n)}},r.readAsArrayBuffer(n)};var k=a(77),x=a(78),C=a.n(x),z=(a(217),a(218),a(196)),_=a(55),L=a(191),A=a(57),D=a(56),R=a(58),M=a(117),T=function(e){function t(e){var a;Object(_.a)(this,t),a=Object(A.a)(this,Object(D.a)(t).call(this,e));e.keys;return a.state={clicked:!1,color:"#000"},a}return Object(R.a)(t,e),Object(L.a)(t,[{key:"render",value:function(){return this.state.clicked?r.a.createElement(M.SketchPicker,null):r.a.createElement("div",{style:{backgroundColof:this.state.color,border:"3px solid whitesmoke",borderRadius:"4px",width:"16px",height:"16px",float:"right"}})}}]),t}(r.a.Component);T.defaultProps={};var P=function(e){return{type:"LOAD_MODEL",model:e,id:Date.now()}},B=function(e){return{type:"CHANGE_SECTION",section:e}};var I=Object(d.b)((function(e){return{layers:e.api.layers}}),(function(e){return{changeSection:function(t){return e(B(t))}}}))((function(e){var t=e.keys,a=t,c=Object(n.useState)(e.layers),i=Object(s.a)(c,2),l=i[0],o=i[1];return Object(n.useEffect)((function(){o(e.layers)}),[e.layers]),r.a.createElement("span",{className:"cus-label"},r.a.createElement("span",null,"operations: "),r.a.createElement("span",{style:{color:"blue"},onClick:function(){setTimeout((function(){}),0)}},"Edit"),"\xa0",r.a.createElement("label",{onClick:function(e){return e.stopPropagation()}},r.a.createElement("input",{type:"checkbox"})," checked"),"\xa0",r.a.createElement("span",{style:{color:"#EB0000"},onClick:function(e){window.confirm("sure to delete?")&&e.stopPropagation()}},"Delete")),r.a.createElement("div",{style:{margin:"0 20px"}},r.a.createElement(z.a,{className:"myCls",showLine:!0,checkable:!0,multiple:!1,checkStrictly:!0,selectable:!0,defaultExpandAll:!0,onExpand:function(e){console.log("onExpand",e)},defaultSelectedKeys:[],defaultCheckedKeys:a,onSelect:function(t,a){var n=a.node.title.toLowerCase();console.log("selected",t,a),e.changeSection(t.length?n:null)},onCheck:function(e,t){console.log("onCheck",e,t)},treeData:l}))})),J=a(121),F=a(7);a(427);var W=Object(d.b)((function(e){return{models:e.api.models,title:e.api.section.title,scene:e.api.scene,vectors:e.api.vectors.data}}),(function(e){return{loadModel:function(t){return e(P(t))},changeSection:function(t){return e(B(t))}}}))((function(e){var t=Object(n.useState)({}),a=Object(s.a)(t,2),c=a[0],i=a[1],d=Object(n.useState)(JSON.stringify({})),u=Object(s.a)(d,2),m=u[0],p=u[1],f=Object(n.useState)(JSON.stringify({})),b=Object(s.a)(f,2),E=b[0],h=b[1],v=Object(n.useState)(JSON.stringify({})),g=Object(s.a)(v,2),y=g[0],O=g[1],S=Object(n.useState)({}),w=Object(s.a)(S,2),N=w[0],j=w[1];Object(n.useEffect)((function(){var t={},a={},n={},r={},l={};e.models.data.map((function(e){t[e.id]=m[e.id]||JSON.stringify({x:0,y:0,z:0}),a[e.id]=y[e.id]||JSON.stringify({x:0,y:0,z:0}),n[e.id]=E[e.id]||JSON.stringify({x:1,y:1,z:1}),r[e.id]=c[e.id]||"info",l[e.id]=N[e.id]||0})),p(t),O(a),h(n),i(r),j(l)}),[e.models.data]);var k=function(e,t,a,n){return e(Object(o.a)({},a,Object(F.a)({},t,n)))};return r.a.createElement("div",{className:"ModelList container"},r.a.createElement("h3",null,e.title),r.a.createElement("div",{className:"row"},e.models.data.map((function(t){return r.a.createElement("div",{className:"col-md-6 col-sm-6 col-xs-12"},r.a.createElement("div",{className:"model-item"},"info"===c[t.id]?r.a.createElement("span",{className:"settings",onClick:function(){return k(i,t.id,c,"settings")}},r.a.createElement("i",{className:"fas fa-cog"})):r.a.createElement("span",{className:"settings",onClick:function(){return k(i,t.id,c,"info")}},r.a.createElement("i",{className:"fas fa-arrow-right"})),r.a.createElement("div",{className:"model-item-inner"},"info"===c[t.id]?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"id: ",t.id),r.a.createElement("div",null,"name: ",t.name),r.a.createElement("div",null,"size: ",(t.size/1e3/1e3).toFixed(2)," Mb"),r.a.createElement("button",{style:{width:"100%"},className:"btn btn-light",onClick:function(){e.vectors.filter((function(e){return e.id==N[t.id]}))[0].array[0].map((function(a){var n,r=t.mesh.clone(),c=JSON.parse(y[t.id]);c.x=Number(c.x),c.y=Number(c.y),c.z=Number(c.z);var i=JSON.parse(E[t.id]);i.x=Number(i.x),i.y=Number(i.y),i.z=Number(i.z),r.rotation.set(c.x,c.y,c.z),r.scale.set(i.x,i.y,i.z),(n=r.position).set.apply(n,Object(l.a)(a)),r.castShadow=!0,r.receiveShadow=!0,e.scene.add(r)}))}},"Add To Scene")):r.a.createElement(r.a.Fragment,null,r.a.createElement("label",null,"Rotation"),r.a.createElement("input",{onChange:function(e){return k(O,t.id,y,e.target.value)},value:y[t.id]}),r.a.createElement("label",null,"Scale"),r.a.createElement("input",{onChange:function(e){return k(h,t.id,E,e.target.value)},value:E[t.id]}),r.a.createElement("label",null,"Position"),r.a.createElement("select",{onChange:function(e){k(j,t.id,N,e.target.value)}},r.a.createElement("option",{value:0,selected:0==N[t.id]},"Select"),e.vectors.map((function(e){return r.a.createElement("option",{value:e.id,selected:N[t.id]==e.id},e.name)})))))))}))))}));var V=Object(d.b)((function(e){return{models:e.api.models,title:e.api.section.title,scene:e.api.scene,vectors:e.api.vectors.data,plane:e.api.plane}}),(function(e){return{}}))((function(e){var t=Object(n.useState)(0),a=Object(s.a)(t,2),c=a[0];return a[1],r.a.createElement("div",{className:"ModelList container"},r.a.createElement("h3",null,e.title),r.a.createElement("select",{onChange:function(t){var a,n=e.vectors.filter((function(e){return e.id==t.target.value}))[0].array[0],r=e.plane.geometry.attributes.position.array;a=0;for(var c=0;c<1e4;c++)a++,a++,r[a++]=.01*((n[c]||[])[2]||0);e.plane.geometry.attributes.position.needsUpdate=!0;var i=new S.X;i.crossOrigin="",i.load("../assets/ground-texture.png",(function(t){var a=new S.B({map:t});e.plane.material=a,e.plane.material.needsUpdate=!0}),(function(){}),(function(e){console.log(e)}))}},r.a.createElement("option",{value:0,selected:0==c},"Select"),e.vectors.map((function(e){return r.a.createElement("option",{value:e.id,selected:c==e.id},e.name)}))))}));C.a.setAppElement("#root");var H=Object(d.b)((function(e){return{section:e.api.section.active,title:e.api.section.title,layers:e.api.layers}}),(function(e){return{loadModel:function(t){return e(P(t))},loadVector:function(t){return e(function(e){return{type:"LOAD_VECTOR",vector:e,id:Date.now()}}(t))},changeSection:function(t){return e(B(t))},setScene:function(t){return e(function(e){return{type:"SET_SCENE",scene:e,id:Date.now()}}(t))},setPlane:function(t){return e(function(e){return{type:"SET_PLANE",plane:e,id:Date.now()}}(t))},setLayers:function(t){return e(function(e){return{type:"SET_LAYERS",layers:e}}(t))}}}))((function(e){var t,a=Object(n.useState)(!1),c=Object(s.a)(a,2),i=c[0],d=c[1],S=Object(n.useState)(!1),w=Object(s.a)(S,2),N=w[0],x=w[1],z=Object(n.useState)([]),_=Object(s.a)(z,2),L=_[0],A=_[1],D=Object(n.useState)({camera:{},controls:{},scene:{},renderer:{},pointer:{},partials:{},loaders:{},onWindowResize:function(){}}),R=Object(s.a)(D,2),M=R[0],T=R[1],P=function(){return x(!N)};return Object(n.useEffect)((function(){var t=M.camera,a=M.controls,n=M.scene,r=M.renderer,c=M.pointer,i=(M.partials,M.loaders),l=(document.getElementById("three-map"),j(t,a,n,r,c,0,i));e.setScene(l.scene),e.setPlane(l.partials.plane),T(Object(o.a)({},l))}),[]),r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement(u.a,{expand:"md",className:"navbar navbar-dark"},r.a.createElement(m.a,{href:"/"},r.a.createElement("div",{className:"logo-container"},r.a.createElement("div",{className:"logo"}),"Mergin' Mode")),r.a.createElement(p.a,{onClick:function(){return d(!i)}}),r.a.createElement(f.a,{isOpen:i,navbar:!0},r.a.createElement(b.a,{className:"mr-auto",navbar:!0},r.a.createElement(E.a,{nav:!0,inNavbar:!0},r.a.createElement(h.a,{nav:!0,caret:!0},"File"),r.a.createElement(v.a,{right:!0},r.a.createElement(g.a,{onClick:P},r.a.createElement("span",null,"Import ")),r.a.createElement(g.a,{divider:!0})))),r.a.createElement(y.a,null,r.a.createElement(O.a,{href:"https://github.com/prieston/mergin_mode",target:"_blank"},r.a.createElement("i",{class:"fab fa-github"}),r.a.createElement("span",null,"GitHub")))))),r.a.createElement("main",null,r.a.createElement(k.a,{split:"vertical",minSize:50,maxSize:-50,defaultSize:"20%",onChange:M.onWindowResize},r.a.createElement(I,null),r.a.createElement(k.a,{split:"horizontal",minSize:50,maxSize:-50,defaultSize:"80%",onChange:M.onWindowResize},r.a.createElement("div",{id:"three-map"}),null!==e.section&&("models"===(t=e.section)?r.a.createElement(W,null):"vertices"===t?r.a.createElement(V,null):r.a.createElement("span",null))))),r.a.createElement(C.a,{isOpen:N,onRequestClose:function(){return x(!N)}},r.a.createElement("div",{className:"container form"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-12"},r.a.createElement("input",{className:"form-control",type:"file",onChange:function(e){A(Object(l.a)(e.target.files))}}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("button",{className:"btn btn-primary form-control",onClick:function(){var t=L[0].name.split(".")[L[0].name.split(".").length-1];if(["xlsx","xls","ods","csv","xyz"].indexOf(t)>-1){var a=new FileReader,n=[];a.onload=function(e){var t=e.target.result,a=J.read(t,{type:"binary"}),r=a.SheetNames[0],c=a.Sheets[r],i=J.utils.sheet_to_csv(c,{header:1});n.push(i.split("\n").map((function(e){return e.split(",").filter((function(e){return e.length>0})).map((function(e){return Number(e)}))})))},a.readAsBinaryString(L[0]),x(!N);var r=L[0],c=r.name,i=r.size,l=JSON.parse(JSON.stringify(e.layers));l[1].children[2].children.push({key:"1-2-".concat(l[1].children[2].children.length),title:c,checkable:!1,selectable:!1}),e.setLayers(l),e.loadVector({name:c,size:i,array:n})}else!function(t){var a=t[0],n=a.name,r=a.size;M.scene;(new M.loaders.FBXLoader).load2(t,(function(t){t.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),e.loadModel({name:n,size:r,object:t}),x(!N);var a=JSON.parse(JSON.stringify(e.layers));a[0].children.push({key:"0-".concat(a[0].children.length),title:n,checkable:!1,selectable:!1}),e.setLayers(a)}))}(L)}},"Load")),r.a.createElement("div",{className:"col-sm-6"},r.a.createElement("button",{className:"btn btn-secondary form-control",onClick:P},"Close"))))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var X=a(37),U=a(194),G=a(195),Y={layers:[{key:"0",title:"Models",checkable:!1,selectable:!0,children:[]},{key:"1",title:"Scene",checkable:!1,selectable:!1,children:[{key:"1-0",title:"Background",checkable:!1,selectable:!1,children:[{key:"1-0-0",title:"Color"},{key:"1-0-1",title:"Image"},{key:"1-0-2",title:"Video"}]},{key:"1-1",title:"Ground",checkable:!1,selectable:!1,children:[{key:"1-1-0",title:"Color"},{key:"1-1-1",title:"Image"},{key:"1-1-2",title:"Vertices"}]},{key:"1-2",title:"Vector Layers",checkable:!1,selectable:!1,children:[]},{key:"1-3",title:"Model Layers",checkable:!1,selectable:!1,children:[]}]}],scene:{},plane:{},models:{data:[]},vectors:{data:[]},section:{active:null,title:null}},q={models:"Models"},K=Object(X.c)({api:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_MODEL":return Object.assign({},e,{models:Object.assign({},e.models,{data:[].concat(Object(l.a)(e.models.data),[{id:[t.id],mesh:t.model.object,name:t.model.name,size:t.model.size}])})});case"LOAD_VECTOR":return Object.assign({},e,{vectors:Object.assign({},e.vectors,{data:[].concat(Object(l.a)(e.vectors.data),[{id:[t.id],array:t.vector.array,name:t.vector.name,size:t.vector.size}])})});case"CHANGE_SECTION":return Object.assign({},e,{section:Object.assign({},e.section,{active:t.section,title:q[t.section]||null})});case"SET_SCENE":return Object.assign({},e,{scene:t.scene});case"SET_PLANE":return Object.assign({},e,{plane:t.plane});case"SET_LAYERS":return Object.assign({},e,{layers:t.layers});default:return e}}}),Z=document.getElementById("root"),$=Object(U.createLogger)({}),Q=Object(X.d)(K,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),Object(X.a)(G.a,$));i.a.render(r.a.createElement(d.a,{store:Q},r.a.createElement(H,null)),Z),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[198,1,2]]]);
//# sourceMappingURL=main.3884dfcc.chunk.js.map